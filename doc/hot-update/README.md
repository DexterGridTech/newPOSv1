# IMPos2 热更新系统设计文档

## 文档概览

本文档详细描述了 IMPos2 企业级终端热更新系统的完整设计方案。

## 文档列表

### ✅ 已完成文档

1. **[热更新系统设计总览](./01-热更新系统设计总览.md)**
   - 系统概述
   - 设计目标
   - 核心特性
   - 技术选型
   - 业界参考案例

2. **[热更新原理与机制](./02-热更新原理与机制.md)**
   - React Native 热更新基础原理
   - 热更新的工作流程
   - 版本管理机制
   - 更新策略分级（强制/自动/提示）
   - 安全机制（HTTPS + RSA + MD5）
   - 回滚机制（30秒超时自动回滚）
   - 双屏更新支持

3. **[系统架构设计](./03-系统架构设计.md)**
   - 整体架构图
   - 客户端架构（HotUpdateManager、TurboModule）
   - 服务端架构（Nginx、API服务、推送服务）
   - 数据库设计（版本表、设备表、灰度表、日志表）

4. **[更新包管理](./04-更新包管理.md)**
   - 更新包打包流程（构建、签名、压缩、上传）
   - 版本号管理（双版本号策略）
   - 更新包存储（服务端和客户端）
   - 更新包传输（下载、网络检测）
   - 灰度发布策略（设备ID、门店ID、百分比）

### 📝 待完成文档

5. **客户端实现方案**（即将完成）
   - 详细的客户端代码实现
   - TurboModule 完整代码
   - 版本管理、下载管理、安装管理
   - 超时检测和回滚实现

6. **服务端实现方案**（即将完成）
   - API 服务实现
   - 推送服务实现
   - 灰度发布算法
   - 管理后台设计

7. **常见问题与解决方案**（即将完成）
   - 更新失败处理
   - 网络异常处理
   - 存储空间不足
   - 版本兼容性问题
   - 性能优化建议

## 核心特性总结

### ✅ 已设计完成的功能

1. **JS Bundle 热更新**
   - 无需重新安装 APK
   - 动态更新业务逻辑
   - 支持全量更新

2. **版本独立管理**
   - 原生版本：1.0.0
   - Bundle 版本：1.0.0.456
   - 版本兼容性检查

3. **三级更新策略**
   - 强制静默更新：紧急修复
   - 自动静默更新：日常更新
   - 提示更新：重大功能

4. **服务器推送**
   - WebSocket 实时推送
   - 设备在线状态管理
   - 推送日志记录

5. **灰度发布**
   - 按设备 ID 灰度
   - 按门店 ID 灰度
   - 按百分比灰度

6. **自动回滚**
   - 30秒超时检测
   - 更新失败自动回滚
   - 保留10个历史版本

7. **双屏支持**
   - 主副屏使用同一 Bundle
   - 复用现有重启机制
   - 主屏初始化完成后启动副屏

8. **安全机制**
   - HTTPS 传输加密
   - RSA 签名验证
   - MD5 完整性校验
   - 版本单调递增

## 技术栈

### 客户端
- **语言**: Kotlin
- **框架**: React Native 0.76.6
- **桥接**: TurboModule
- **网络**: OkHttp3
- **存储**: Android File System + SharedPreferences

### 服务端
- **Web 服务器**: Nginx 1.24+
- **应用服务器**: Node.js 18+ + Express
- **数据库**: PostgreSQL 14+
- **推送**: Socket.IO
- **文件存储**: 本地文件系统

## 快速开始

### 阅读顺序建议

1. 如果你是**产品经理/项目经理**
   - 先看：01-热更新系统设计总览
   - 再看：02-热更新原理与机制（第4节：更新策略分级）

2. 如果你是**前端开发**
   - 先看：02-热更新原理与机制
   - 再看：05-客户端实现方案（待完成）

3. 如果你是**后端开发**
   - 先看：03-系统架构设计（第3节：服务端架构）
   - 再看：06-服务端实现方案（待完成）

4. 如果你是**运维/DevOps**
   - 先看：04-更新包管理
   - 再看：06-服务端实现方案（待完成）

5. 如果你是**测试工程师**
   - 先看：02-热更新原理与机制
   - 再看：07-常见问题与解决方案（待完成）

## 文档状态

| 文档 | 状态 | 完成度 | 最后更新 |
|------|------|--------|----------|
| 01-热更新系统设计总览 | ✅ 完成 | 100% | 2026-02-05 |
| 02-热更新原理与机制 | ✅ 完成 | 100% | 2026-02-05 |
| 03-系统架构设计 | ✅ 完成 | 100% | 2026-02-05 |
| 04-更新包管理 | ✅ 完成 | 100% | 2026-02-05 |
| 05-客户端实现方案 | 🚧 进行中 | 0% | - |
| 06-服务端实现方案 | 🚧 进行中 | 0% | - |
| 07-常见问题与解决方案 | 🚧 进行中 | 0% | - |

## 贡献指南

如果你发现文档中有任何问题或需要补充的内容，请：

1. 在项目中创建 Issue
2. 描述问题或建议
3. 提交 Pull Request

## 联系方式

如有疑问，请联系项目负责人。

---

**版本**: v1.0.0  
**创建日期**: 2026-02-05  
**最后更新**: 2026-02-05
